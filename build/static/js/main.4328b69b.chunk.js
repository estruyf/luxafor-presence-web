(this["webpackJsonpluxafor-presence-web"]=this["webpackJsonpluxafor-presence-web"]||[]).push([[0],{48:function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e.Available="Available",e.AvailableIdle="AvailableIdle",e.Away="Away",e.BeRightBack="BeRightBack",e.Busy="Busy",e.BusyIdle="BusyIdle",e.DoNotDisturb="DoNotDisturb",e.Offline="Offline",e.PresenceUnknown="PresenceUnknown"}(n||(n={}))},49:function(e,t){},50:function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e[e.StartTime=1]="StartTime",e[e.EndTime=2]="EndTime"}(n||(n={}))},54:function(e,t){},55:function(e,t){},56:function(e,t,r){"use strict";var n=r(12),a=r.n(n),i=r(16),c=r(35),s=r(17),o=r(13),u=r(29),l=r(30),p=r(32),f=r(0),h=r.n(f),v=(r(81),r(64)),m=function(){var e=Object(i.a)(a.a.mark((function e(t,r){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(r)}});case 2:return n=e.sent,e.abrupt("return",n.json());case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ")>-1,r=e.indexOf("Trident/")>-1;return t||r},b="https://graph.microsoft.com/beta/me/presence",g={LOGIN:{scopes:["openid","profile","User.Read"]},PRESENCE:{scopes:["Presence.Read"]}},y=new v.a({auth:{clientId:"66204339-daf1-40fa-aa31-57342272edce",authority:"https://login.microsoftonline.com/common",validateAuthority:!0,postLogoutRedirectUri:"https://luxafor-presence.azurewebsites.net",navigateToLoginRequestUrl:!1},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:d()},system:{navigateFrameWait:0,logger:{error:console.error,errorPii:console.error,info:console.log,infoPii:console.log,verbose:console.log,verbosePii:console.log,warning:console.warn,warningPii:console.warn}}}),k=d(),T=r(65),w=r(128),S=r(120),E=r(130),O=r(124),x=r(125),A=(r(82),r(6)),C=function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,null,[{key:"setColor",value:function(){var e=Object(i.a)(a.a.mark((function e(t,r){var n,i,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="000000",t&&r){e.next=3;break}return e.abrupt("return",n);case 3:e.t0=r,e.next=e.t0===A.Availability.Available||e.t0===A.Availability.AvailableIdle?6:e.t0===A.Availability.Away||e.t0===A.Availability.BeRightBack?8:e.t0===A.Availability.Busy||e.t0===A.Availability.BusyIdle||e.t0===A.Availability.DoNotDisturb?10:(e.t0===A.Availability.Offline||(e.t0,A.Availability.PresenceUnknown),12);break;case 6:return n="008000",e.abrupt("break",14);case 8:return n="B2B200",e.abrupt("break",14);case 10:return n="990000",e.abrupt("break",14);case 12:return n="000000",e.abrupt("break",14);case 14:return i={userId:t,actionFields:{color:"custom",custom_color:n}},e.next=17,fetch("/api/setColor",{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(i)});case 17:if(!(c=e.sent)||!c.ok){e.next=22;break}return e.abrupt("return",n);case 22:return e.abrupt("return","000000");case 23:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getDeviceSetting",value:function(e){return localStorage&&localStorage.getItem("Luxafor:".concat(e))||""}},{key:"setDeviceSetting",value:function(e,t){localStorage&&localStorage.setItem("Luxafor:".concat(e),t)}}]),e}(),I={deviceId:C.getDeviceSetting("Device:ID"),refreshNr:C.getDeviceSetting("RefreshNr")||2,startTime:C.getDeviceSetting("StartTime"),endTime:C.getDeviceSetting("EndTime"),presence:"",overwrittenPresence:null,color:"000000"},D=h.a.createContext(I),P=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e))).deviceChange=function(e){e&&e.target&&e.target.value&&r.props.updateDeviceId(e.target.value)},r.refreshChange=function(e){e&&e.target&&e.target.value&&r.props.updateRefresh(parseInt(e.target.value))},r}return Object(p.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props,t=e.account,r=e.onSignIn,n=e.onSignOut,a=e.updateTime,i=this.context,c=i.deviceId,s=i.refreshNr,o=i.startTime,u=i.endTime;return h.a.createElement("header",{className:"app__header"},t?h.a.createElement(O.a,{fixed:!0},h.a.createElement(x.a,{container:!0,style:{flexGrow:1},spacing:1},h.a.createElement(x.a,{item:!0,xs:12},h.a.createElement(S.a,{onClick:n,variant:"outlined",color:"secondary"},"Sign Out: ",t.userName)),h.a.createElement(x.a,{className:"app__header__inputs",container:!0},h.a.createElement(x.a,{item:!0,xs:3},h.a.createElement(E.a,{label:"Device ID",variant:"filled",required:!0,value:c,onChange:this.deviceChange})),h.a.createElement(x.a,{item:!0,xs:3},h.a.createElement(E.a,{label:"Refresh time (minutes)",variant:"filled",value:s||"",type:"number",inputProps:{min:"1",max:"10",step:"1"},onChange:this.refreshChange})),h.a.createElement(x.a,{item:!0,xs:3},h.a.createElement(E.a,{label:"Start time",variant:"filled",value:o,inputProps:{pattern:"([01]?[0-9]|2[0-3]):[0-5][0-9]"},onChange:function(e){return a(A.TimeType.StartTime,e.target.value)}})),h.a.createElement(x.a,{item:!0,xs:3},h.a.createElement(E.a,{label:"End time",variant:"filled",value:u,inputProps:{pattern:"([01]?[0-9]|2[0-3]):[0-5][0-9]"},onChange:function(e){return a(A.TimeType.EndTime,e.target.value)}}))))):h.a.createElement(S.a,{onClick:r,variant:"outlined",color:"primary"},"Sign In"))}}]),t}(h.a.Component);P.contextType=D;var j=P,N=(r(86),r(63)),R=r.n(N),_=r(62),B=r.n(_),q=function(e){return h.a.createElement("footer",{className:"app__footer"},h.a.createElement(S.a,{href:"https://www.eliostruyf.com",title:"Go to the website of Elio Struyf"},"Copyright ",h.a.createElement(B.a,null)," Elio Struyf - https://www.eliostruyf.com")," - ",h.a.createElement(S.a,{href:"https://github.com/estruyf",className:"app__footer_github"},h.a.createElement(R.a,null)))},F=(r(88),r(129)),M=r(131),U=function(e){var t=function(t){e.overwritePresense(t.target.value)};return h.a.createElement(D.Consumer,null,(function(r){var n="#282c34";switch(r.overwrittenPresence||r.presence){case A.Availability.Available:case A.Availability.AvailableIdle:n="#58BC82";break;case A.Availability.Busy:case A.Availability.BusyIdle:case A.Availability.DoNotDisturb:n="#6F1A07";break;case A.Availability.Away:case A.Availability.BeRightBack:n="#F6AE2D";break;default:n="#282c34"}return h.a.createElement("main",{className:"app__main",style:{backgroundColor:"".concat(n)}},h.a.createElement("h1",null,"Luxafor - Presence"),(r.overwrittenPresence||r.presence)&&h.a.createElement(h.a.Fragment,null,h.a.createElement(F.a,{value:r.overwrittenPresence||r.presence,onChange:t,title:"Manually select a presence status"},Object.keys(A.Availability).map((function(e){return h.a.createElement(M.a,{value:e},e)}))),r.overwrittenPresence&&h.a.createElement(S.a,{className:"app__main__reset",variant:"outlined",color:"secondary",title:"Reset the presence status. This will restart the automatic refresh.",onClick:function(){return e.overwritePresense(null)}},"Reset presence")))}))},L=function(e){if(e&&e.includes(":")){var t=e.split(":");return{hour:parseInt(t[0]),minutes:parseInt(t[1])}}return null};r.d(t,"a",(function(){return z}));var W,G=Object(T.a)({palette:{type:"dark"},overrides:{MuiSelect:{select:{fontSize:"calc(10px + 2vmin)"}}}}),H=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e))).refreshTimer=void 0,r.updateDeviceId=function(e){r.setState((function(t){return Object(c.a)({},t).deviceId=e,C.setDeviceSetting("Device:ID",e),Object(c.a)({},t,{deviceId:e})}))},r.updateRefresh=function(e){r.setState((function(t){return C.setDeviceSetting("RefreshNr",e),Object(c.a)({},t,{refreshNr:e})}))},r.updateTime=function(e,t){e&&t&&(C.setDeviceSetting(A.TimeType[e],t),e===A.TimeType.StartTime?r.setState({startTime:t}):r.setState({endTime:t}))},r.startPresenceCheck=Object(i.a)(a.a.mark((function e(){var t,n,i,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.props.acquireToken,e.prev=1,e.prev=2,e.next=5,t(g.PRESENCE);case 5:n=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),r.setState({error:e.t0.message}),e.abrupt("return");case 12:if(!n){e.next=21;break}return e.next=15,m(b,n.accessToken);case 15:if(!(i=e.sent)||!i.availability){e.next=21;break}return e.next=19,C.setColor(r.state.deviceId,i.availability);case 19:c=e.sent,r.setState({presence:i.availability,color:c});case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(1),r.setState({error:"Unable to fetch Graph profile."});case 26:case"end":return e.stop()}}),e,null,[[1,23],[2,8]])}))),r.overwritePresense=function(){var e=Object(i.a)(a.a.mark((function e(){var t,n,i=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=i.length>0&&void 0!==i[0]?i[0]:null)){e.next=10;break}return r.stopPresenceCheck(),e.next=6,C.setColor(r.state.deviceId,t);case 6:n=e.sent,r.setState({color:n}),e.next=11;break;case 10:r.startDataFetching();case 11:r.setState({overwrittenPresence:t});case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.state=Object(c.a)({},I),r}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.props.account&&this.state.deviceId&&this.state.refreshNr&&this.startDataFetching()}},{key:"componentDidUpdate",value:function(e,t){t.refreshNr===this.state.refreshNr&&t.startTime===this.state.startTime&&t.endTime===this.state.endTime||this.startDataFetching(),e.account!==this.props.account&&this.props.account&&this.startDataFetching(),this.props.account||this.stopPresenceCheck()}},{key:"startDataFetching",value:function(){var e=this,t=this.state,r=t.deviceId,n=t.startTime,a=t.endTime,i=t.refreshNr,c=L(n),s=L(a),o=new Date,u=null,l=null;c&&(o.getHours()<c.hour||o.getHours()===c.hour&&o.getMinutes()<c.minutes)&&(u=A.Availability.Offline,l="000000"),s&&(o.getHours()>s.hour||o.getHours()===s.hour&&o.getMinutes()>s.minutes)&&(u=A.Availability.Offline,l="000000");var p=!0;u&&(u!==this.state.presence&&(C.setColor(r,A.Availability.Offline),this.setState({presence:u,color:l})),p=!1),p&&this.startPresenceCheck(),i&&(this.refreshTimer=setTimeout((function(){e.startDataFetching()}),60*i*1e3))}},{key:"stopPresenceCheck",value:function(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null)}},{key:"render",value:function(){return h.a.createElement(D.Provider,{value:Object(c.a)({},this.state,{error:""})},h.a.createElement(w.a,{theme:G},h.a.createElement("div",{className:"app"},h.a.createElement(j,{account:this.props.account,onSignIn:this.props.onSignIn,onSignOut:this.props.onSignOut,updateRefresh:this.updateRefresh,updateDeviceId:this.updateDeviceId,updateTime:this.updateTime}),h.a.createElement(U,{overwritePresense:this.overwritePresense}),this.state.error&&h.a.createElement("p",{className:"app__error"},this.state.error),h.a.createElement(q,null))))}}]),t}(h.a.Component),z=(W=H,function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(l.a)(t).call(this,e))).authCalled=!1,r.state={account:null,error:null,presence:null},r}return Object(p.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=Object(i.a)(a.a.mark((function e(){var t,r=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.handleRedirectCallback((function(e){if(e){var t=e.errorMessage?e.errorMessage:"Unable to acquire access token.";r.setState({error:t})}})),t=y.getAccount(),this.setState({account:t});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"acquireToken",value:function(){var e=Object(i.a)(a.a.mark((function e(t,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.acquireTokenSilent(t);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),!((n=e.t0.errorCode)&&n.length&&(n.indexOf("consent_required")>-1||n.indexOf("interaction_required")>-1||n.indexOf("login_required")>-1))){e.next=12;break}return e.abrupt("return",r?y.acquireTokenRedirect(t):y.acquireTokenPopup(t));case 12:console.error("Non-interactive error:",e.t0.errorCode);case 13:case"end":return e.stop()}var n}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"onSignIn",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var r,n=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.authCalled){e.next=2;break}return e.abrupt("return");case 2:if(this.authCalled=!0,!t){e.next=5;break}return e.abrupt("return",y.loginRedirect(g.PRESENCE));case 5:return e.next=7,y.loginPopup(g.PRESENCE).catch((function(e){n.setState({error:e.message})}));case 7:(r=e.sent)&&this.setState({account:r.account,error:null});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onSignOut",value:function(){y.logout()}},{key:"getAccessToken",value:function(){return""}},{key:"render",value:function(){var e=this;return h.a.createElement(W,Object.assign({},this.props,{account:this.state.account,error:this.state.error,presence:this.state.presence,onSignIn:function(){return e.onSignIn(k)},onSignOut:function(){return e.onSignOut()},acquireToken:this.acquireToken}))}}]),t}(f.Component))},57:function(e,t,r){"use strict";var n=r(56);r.d(t,"AppWithAuth",(function(){return n.a}));r(54),r(55)},6:function(e,t,r){"use strict";var n=r(48);r.d(t,"Availability",(function(){return n.a}));var a=r(49);r.o(a,"TimeType")&&r.d(t,"TimeType",(function(){return a.TimeType}));var i=r(50);r.d(t,"TimeType",(function(){return i.a}))},74:function(e,t,r){e.exports=r(89)},79:function(e,t,r){},81:function(e,t,r){},82:function(e,t,r){},86:function(e,t,r){},88:function(e,t,r){},89:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),i=r(8),c=r.n(i),s=(r(79),r(57));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(s.AppWithAuth,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[74,1,2]]]);
//# sourceMappingURL=main.4328b69b.chunk.js.map