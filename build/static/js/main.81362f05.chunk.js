(this["webpackJsonpluxafor-presence-web"]=this["webpackJsonpluxafor-presence-web"]||[]).push([[0],[,,function(e,t,n){"use strict";var r=n(8);n.d(t,"Availability",(function(){return r.a}));n(9)},,,,,,function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.Available="Available",e.AvailableIdle="AvailableIdle",e.Away="Away",e.BeRightBack="BeRightBack",e.Busy="Busy",e.BusyIdle="BusyIdle",e.DoNotDisturb="DoNotDisturb",e.Offline="Offline",e.PresenceUnknown="PresenceUnknown"}(r||(r={}))},function(e,t){},,,,,,function(e,t,n){e.exports=n(23)},,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var r,a=n(0),i=n.n(a),c=n(10),o=n.n(c),u=(n(20),n(4)),s=(n(21),n(1)),l=n.n(s),f=n(3),p=n(5),h=n(6),v=n(13),b=n(11),g=n(14),d=n(12),m=function(){var e=Object(f.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(n)}});case 2:return r=e.sent,e.abrupt("return",r.json());case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ")>-1,n=e.indexOf("Trident/")>-1;return t||n},k="https://graph.microsoft.com/beta/me/presence",O={LOGIN:{scopes:["openid","profile","User.Read"]},PRESENCE:{scopes:["Presence.Read"]}},S=new d.a({auth:{clientId:"66204339-daf1-40fa-aa31-57342272edce",authority:"https://login.microsoftonline.com/common",validateAuthority:!0,postLogoutRedirectUri:"https://luxafor-presence.azurewebsites.net",navigateToLoginRequestUrl:!1},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:y()},system:{navigateFrameWait:0,logger:{error:console.error,errorPii:console.error,info:console.log,infoPii:console.log,verbose:console.log,verbosePii:console.log,warning:console.warn,warningPii:console.warn}}}),w=y(),x=n(2),A=function(){function e(){Object(p.a)(this,e)}return Object(h.a)(e,null,[{key:"setColor",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){var r,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r="000000",t&&n){e.next=3;break}return e.abrupt("return",r);case 3:e.t0=n,e.next=e.t0===x.Availability.Available||e.t0===x.Availability.AvailableIdle?6:e.t0===x.Availability.Away||e.t0===x.Availability.BeRightBack?8:e.t0===x.Availability.Busy||e.t0===x.Availability.BusyIdle||e.t0===x.Availability.DoNotDisturb?10:(e.t0===x.Availability.Offline||(e.t0,x.Availability.PresenceUnknown),12);break;case 6:return r="008000",e.abrupt("break",14);case 8:return r="B2B200",e.abrupt("break",14);case 10:return r="990000",e.abrupt("break",14);case 12:return r="000000",e.abrupt("break",14);case 14:return a={userId:t,actionFields:{color:"custom",custom_color:r}},e.next=17,fetch("/api/setColor",{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(a)});case 17:if(!(i=e.sent)||!i.ok){e.next=22;break}return e.abrupt("return",r);case 22:return e.abrupt("return","000000");case 23:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDeviceSetting",value:function(e){return localStorage&&localStorage.getItem("Luxafor:".concat(e))||""}},{key:"setDeviceSetting",value:function(e,t){localStorage&&localStorage.setItem("Luxafor:".concat(e),t)}}]),e}(),E=function(e){if(e&&e.includes(":")){var t=e.split(":");return{hour:parseInt(t[0]),minutes:parseInt(t[1])}}return null},j=function(e,t,n,r){A.setColor(e,t).then((function(e){n(e),r(t)}))},T=(r=function(e){var t=Object(a.useState)("000000"),n=Object(u.a)(t,2),r=n[0],c=n[1],o=Object(a.useState)(""),s=Object(u.a)(o,2),l=s[0],f=s[1],p=Object(a.useState)(A.getDeviceSetting("Device:ID")),h=Object(u.a)(p,2),v=h[0],b=h[1],g=Object(a.useState)("2"),d=Object(u.a)(g,2),m=d[0],y=d[1],k=Object(a.useState)(A.getDeviceSetting("StartTime")),O=Object(u.a)(k,2),S=O[0],w=O[1],T=Object(a.useState)(A.getDeviceSetting("EndTime")),I=Object(u.a)(T,2),C=I[0],D=I[1];e.account;var P=E(S),N=E(C),B=new Date,R=null,q=null;P&&(B.getHours()<P.hour||B.getHours()===P.hour&&B.getMinutes()<P.minutes)&&(R=x.Availability.Offline,q="000000"),N&&(B.getHours()>N.hour||B.getHours()===N.hour&&B.getMinutes()>N.minutes)&&(R=x.Availability.Offline,q="000000"),v&&e.presence&&l!==e.presence&&!R?j(v,e.presence,c,f):R&&l!==x.Availability.Offline&&j(v,x.Availability.Offline,c,f);var _=function(e,t){e&&t&&(A.setDeviceSetting(e,t),"StartTime"===e?w(t):D(t))};return i.a.createElement("div",{className:"App"},i.a.createElement("section",{className:"App-login"},e.account?i.a.createElement("button",{onClick:e.onSignOut},"Sign Out: ",e.account.userName):i.a.createElement("button",{onClick:e.onSignIn},"Sign In"),i.a.createElement("input",{className:"input__device-id",value:v,placeholder:"Device ID",onChange:function(e){e&&e.target&&e.target.value&&(A.setDeviceSetting("Device:ID",e.target.value),b(e.target.value))}}),i.a.createElement("input",{className:"input__refresh",value:m,placeholder:"Refresh rate in minutes",type:"number",onChange:function(t){e.refreshUpdate(t.target.value),y(t.target.value)}}),i.a.createElement("input",{className:"input__start",value:S,placeholder:"Start day",pattern:"([01]?[0-9]|2[0-3]):[0-5][0-9]",onChange:function(e){return _("StartTime",e.target.value)}}),i.a.createElement("input",{className:"input__end",value:C,placeholder:"End day",pattern:"([01]?[0-9]|2[0-3]):[0-5][0-9]",onChange:function(e){return _("EndTime",e.target.value)}})),i.a.createElement("header",{className:"App-header",style:{backgroundColor:"#".concat(q||r)}},i.a.createElement("h1",null,"Luxafor - Presence"),R?i.a.createElement("h2",null,R):e.presence&&i.a.createElement("h2",null,e.presence)))},function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(v.a)(this,Object(b.a)(t).call(this,e))).authCalled=!1,n.nrOfMinutes=2,n.refreshTimer=void 0,n.queryPresence=function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.prev=1,e.next=4,n.acquireToken(O.PRESENCE,t);case 4:r=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),n.setState({error:e.t0.message}),e.abrupt("return");case 11:if(!r){e.next=16;break}return e.next=14,m(k,r.accessToken);case 14:(a=e.sent)&&a.availability&&n.setState({presence:a.availability});case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),n.setState({error:"Unable to fetch Graph profile."});case 21:n.refreshTimer=setTimeout((function(){n.queryPresence()}),60*n.nrOfMinutes*1e3);case 22:case"end":return e.stop()}}),e,null,[[0,18],[1,7]])})));return function(t){return e.apply(this,arguments)}}(),n.updateRefresh=function(e){var t=parseInt(e);!isNaN(t)&&t&&(n.refreshTimer&&(clearTimeout(n.refreshTimer),n.refreshTimer=null),n.refreshTimer=setTimeout((function(){n.queryPresence()}),60*t*1e3))},n.state={account:null,error:null,presence:null},n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=Object(f.a)(l.a.mark((function e(){var t,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S.handleRedirectCallback((function(e){if(e){var t=e.errorMessage?e.errorMessage:"Unable to acquire access token.";n.setState({error:t})}})),t=S.getAccount(),this.setState({account:t}),t&&this.queryPresence(w);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"acquireToken",value:function(){var e=Object(f.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S.acquireTokenSilent(t);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),!((r=e.t0.errorCode)&&r.length&&(r.indexOf("consent_required")>-1||r.indexOf("interaction_required")>-1||r.indexOf("login_required")>-1))){e.next=12;break}return e.abrupt("return",n?S.acquireTokenRedirect(t):S.acquireTokenPopup(t));case 12:console.error("Non-interactive error:",e.t0.errorCode);case 13:case"end":return e.stop()}var r}),e,null,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onSignIn",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var n,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.authCalled){e.next=2;break}return e.abrupt("return");case 2:if(this.authCalled=!0,!t){e.next=5;break}return e.abrupt("return",S.loginRedirect(O.PRESENCE));case 5:return e.next=7,S.loginPopup(O.PRESENCE).catch((function(e){r.setState({error:e.message})}));case 7:(n=e.sent)&&(this.setState({account:n.account,error:null}),this.queryPresence());case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onSignOut",value:function(){S.logout(),this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null)}},{key:"render",value:function(){var e=this;return i.a.createElement(r,Object.assign({},this.props,{account:this.state.account,error:this.state.error,presence:this.state.presence,onSignIn:function(){return e.onSignIn(w)},onSignOut:function(){return e.onSignOut()},refreshUpdate:this.updateRefresh}))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[15,1,2]]]);
//# sourceMappingURL=main.81362f05.chunk.js.map