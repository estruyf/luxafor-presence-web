(this["webpackJsonpluxafor-presence-web"]=this["webpackJsonpluxafor-presence-web"]||[]).push([[0],[,,function(e,t,n){"use strict";var r=n(8);n.d(t,"Availability",(function(){return r.a}));n(9)},,,,,,function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.Available="Available",e.AvailableIdle="AvailableIdle",e.Away="Away",e.BeRightBack="BeRightBack",e.Busy="Busy",e.BusyIdle="BusyIdle",e.DoNotDisturb="DoNotDisturb",e.Offline="Offline",e.PresenceUnknown="PresenceUnknown"}(r||(r={}))},function(e,t){},,,,,,function(e,t,n){e.exports=n(23)},,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var r,a=n(0),c=n.n(a),o=n(10),i=n.n(o),u=(n(20),n(6)),s=(n(21),n(1)),l=n.n(s),p=n(3),f=n(4),b=n(5),v=n(13),h=n(11),d=n(14),g=n(12),k=function(){var e=Object(p.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(n)}});case 2:return r=e.sent,e.abrupt("return",r.json());case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ")>-1,n=e.indexOf("Trident/")>-1;return t||n},m="https://graph.microsoft.com/beta/me/presence",w={LOGIN:{scopes:["openid","profile","User.Read"]},PRESENCE:{scopes:["Presence.Read"]}},O=new g.a({auth:{clientId:"66204339-daf1-40fa-aa31-57342272edce",authority:"https://login.microsoftonline.com/1a8ddc4e-a051-46a5-b1a2-0438a5f7f8c4",validateAuthority:!0,postLogoutRedirectUri:"http://localhost:3000",navigateToLoginRequestUrl:!1},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:y()},system:{navigateFrameWait:0,logger:{error:console.error,errorPii:console.error,info:console.log,infoPii:console.log,verbose:console.log,verbosePii:console.log,warning:console.warn,warningPii:console.warn}}}),S=y(),x=n(2),A=function(){function e(){Object(f.a)(this,e)}return Object(b.a)(e,null,[{key:"setColor",value:function(){var e=Object(p.a)(l.a.mark((function e(t,n){var r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r="000000",t&&n){e.next=3;break}return e.abrupt("return",r);case 3:e.t0=n,e.next=e.t0===x.Availability.Available||e.t0===x.Availability.AvailableIdle?6:e.t0===x.Availability.Away||e.t0===x.Availability.BeRightBack?8:e.t0===x.Availability.Busy||e.t0===x.Availability.BusyIdle||e.t0===x.Availability.DoNotDisturb?10:(e.t0===x.Availability.Offline||(e.t0,x.Availability.PresenceUnknown),12);break;case 6:return r="008000",e.abrupt("break",14);case 8:return r="B2B200",e.abrupt("break",14);case 10:return r="990000",e.abrupt("break",14);case 12:return r="000000",e.abrupt("break",14);case 14:return a={userId:t,actionFields:{color:"custom",custom_color:r}},e.next=17,fetch("/api/setColor",{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(a)});case 17:if(!(c=e.sent)||!c.ok){e.next=22;break}return e.abrupt("return",r);case 22:return e.abrupt("return","000000");case 23:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDeviceId",value:function(){return localStorage&&localStorage.getItem("Luxafor:Device:ID")||""}},{key:"setDeviceId",value:function(e){localStorage&&localStorage.setItem("Luxafor:Device:ID",e)}}]),e}(),I=(r=function(e){var t=Object(a.useState)("000000"),n=Object(u.a)(t,2),r=n[0],o=n[1],i=Object(a.useState)(""),s=Object(u.a)(i,2),l=s[0],p=s[1],f=Object(a.useState)(A.getDeviceId()),b=Object(u.a)(f,2),v=b[0],h=b[1];return e.account,v&&e.presence&&l!==e.presence&&A.setColor(v,e.presence).then((function(t){o(t),p(e.presence)})),c.a.createElement("div",{className:"App"},c.a.createElement("section",{className:"App-login"},e.account?c.a.createElement("button",{onClick:e.onSignOut},"Sign Out"):c.a.createElement("button",{onClick:e.onSignIn},"Sign In"),c.a.createElement("input",{value:v,placeholder:"Device ID",onChange:function(e){e&&e.target&&e.target.value&&(A.setDeviceId(e.target.value),h(e.target.value))}})),c.a.createElement("header",{className:"App-header",style:{backgroundColor:"#".concat(r)}},c.a.createElement("h1",null,"Luxafor - Presence"),e.presence&&c.a.createElement("h2",null,e.presence)))},function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(h.a)(t).call(this,e))).authCalled=!1,n.queryPresence=function(){var e=Object(p.a)(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.prev=1,e.next=4,n.acquireToken(w.PRESENCE,t);case 4:r=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),n.setState({error:e.t0.message}),e.abrupt("return");case 11:if(!r){e.next=16;break}return e.next=14,k(m,r.accessToken);case 14:(a=e.sent)&&a.availability&&n.setState({presence:a.availability});case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),n.setState({error:"Unable to fetch Graph profile."});case 21:window.setTimeout((function(){n.queryPresence()}),1e4);case 22:case"end":return e.stop()}}),e,null,[[0,18],[1,7]])})));return function(t){return e.apply(this,arguments)}}(),n.state={account:null,error:null,presence:null},n}return Object(d.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){var e=Object(p.a)(l.a.mark((function e(){var t,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.handleRedirectCallback((function(e){if(e){var t=e.errorMessage?e.errorMessage:"Unable to acquire access token.";n.setState({error:t})}})),t=O.getAccount(),this.setState({account:t}),t&&this.queryPresence(S);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"acquireToken",value:function(){var e=Object(p.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O.acquireTokenSilent(t);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),!((r=e.t0.errorCode)&&r.length&&(r.indexOf("consent_required")>-1||r.indexOf("interaction_required")>-1||r.indexOf("login_required")>-1))){e.next=12;break}return e.abrupt("return",n?O.acquireTokenRedirect(t):O.acquireTokenPopup(t));case 12:console.error("Non-interactive error:",e.t0.errorCode);case 13:case"end":return e.stop()}var r}),e,null,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onSignIn",value:function(){var e=Object(p.a)(l.a.mark((function e(t){var n,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.authCalled){e.next=2;break}return e.abrupt("return");case 2:if(this.authCalled=!0,!t){e.next=5;break}return e.abrupt("return",O.loginRedirect(w.PRESENCE));case 5:return e.next=7,O.loginPopup(w.PRESENCE).catch((function(e){r.setState({error:e.message})}));case 7:(n=e.sent)&&(this.setState({account:n.account,error:null}),this.queryPresence());case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onSignOut",value:function(){O.logout()}},{key:"render",value:function(){var e=this;return c.a.createElement(r,Object.assign({},this.props,{account:this.state.account,error:this.state.error,presence:this.state.presence,onSignIn:function(){return e.onSignIn(S)},onSignOut:function(){return e.onSignOut()}}))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(c.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[15,1,2]]]);
//# sourceMappingURL=main.141d7ec7.chunk.js.map